<div class="blog-form-container">
  <mat-card class="blog-form-card">

    <mat-card-title>
      @if(onEditing) {
      <mat-icon class="title-icon">edit</mat-icon>
      Edit Blog
      } @else {
      <mat-icon class="title-icon">create</mat-icon>
      Create New Blog
      }
    </mat-card-title>

    <form [formGroup]="blogForm" (ngSubmit)="submitForm()">

      <!-- Title Field with Character Counter -->
      <div class="form-group">
        <mat-form-field appearance="outline" class="full-width">
          <input matInput placeholder="Enter an engaging title for your blog..." formControlName="title"
            maxlength="100" />
          <mat-icon matSuffix class="field-icon">title</mat-icon>
          @if(blogForm.get('title')?.hasError('required')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Title is required
          </mat-error>
          }
          @if(blogForm.get('title')?.hasError('minlength')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Title is too short
          </mat-error>
          }
          @if(blogForm.get('title')?.hasError('maxlength')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Title is too long
          </mat-error>
          }
        </mat-form-field>
        <div class="character-counter" [class.warning]="blogForm.get('title')?.value?.length > 80"
          [class.danger]="blogForm.get('title')?.value?.length > 95">
          {{ blogForm.get('title')?.value?.length || 0 }}/100 characters
        </div>
      </div>

      <!-- @if(!onEditing) { -->

      <!-- Enhanced Cover Image Upload -->
      <div class="form-group">
        <div class="cover-image-upload">
          <input #fileInput type="file" accept="image/*,video/*" (change)="onFileSelected($event)" hidden />

          @if (!selectedFile && (!onEditing || !fileExistForEditing)) {
          <div class="upload-area" (click)="fileInput.click()">
            <mat-icon class="upload-icon">cloud_upload</mat-icon>
            <div class="upload-text">Click to upload media</div>
            <div class="upload-subtext">Supports JPG, JEPG, PNG up to 5MB or WebP, MP4, WebM up to 15MB</div>
          </div>
          }
          @if (selectedFile) {
          @if ( mediaPreview$ | async;as mediaPreview) {
          <div class="file-preview">
            @if (isImage(selectedFile)) {
            <img [src]="mediaPreview" alt="Cover preview" class="preview-image">
            }@else if (isVideo(selectedFile)) {
            <video [src]="mediaPreview" controls playsinline class="preview-image"></video>
            } @else {
            <div class="file-info">
              <mat-icon class="file-icon">videocam</mat-icon>
              <span class="file-name">{{ selectedFile.name }}</span>
            </div>
            }
            <button type="button" mat-button color="primary" (click)="fileInput.click()" class="change-file">
              <mat-icon>swap_horiz</mat-icon>
              Change File
            </button>
          </div>
          }
          }
        </div>
      </div>
      <!-- } -->

      <!-- Short Description with Counter -->
      <div class="form-group">
        <mat-form-field appearance="outline" class="full-width">
          <input matInput placeholder="Write a compelling summary that hooks your readers..."
            formControlName="description" maxlength="200" />
          <mat-icon matSuffix class="field-icon">description</mat-icon>
          @if(blogForm.get('description')?.hasError('required')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Description is required
          </mat-error>
          }
          @if(blogForm.get('description')?.hasError('minlength')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Description is too short
          </mat-error>
          }
          @if(blogForm.get('description')?.hasError('maxlength')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Description is too long
          </mat-error>
          }
        </mat-form-field>
        <div class="character-counter" [class.warning]="blogForm.get('description')?.value?.length > 160"
          [class.danger]="blogForm.get('description')?.value?.length > 190">
          {{ blogForm.get('description')?.value?.length || 0 }}/200 characters
        </div>
      </div>

      <!-- Blog Content with Enhanced Textarea -->
      <div class="form-group">
        <mat-form-field appearance="outline" class="full-width">
          <textarea matInput rows="10" placeholder="Share your thoughts, experiences, and insights with the world..."
            formControlName="content" class="content-textarea"></textarea>
          <mat-icon matSuffix class="field-icon">article</mat-icon>
          @if(blogForm.get('content')?.hasError('required')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Content is required to publish your blog
          </mat-error>
          }
          @if(blogForm.get('content')?.hasError('minlength')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Content is too short
          </mat-error>
          }
          @if(blogForm.get('content')?.hasError('maxlength')) {
          <mat-error>
            <mat-icon>error</mat-icon>
            Content is too long
          </mat-error>
          }
        </mat-form-field>
        <div class="character-counter">
          {{ blogForm.get('content')?.value?.length || 0 }} characters
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button mat-raised-button type="submit" class="submit-button" [disabled]="blogForm.invalid">

          <div class="button-content">
            @if(onEditing) {
            <mat-icon>save</mat-icon>
            <span>Update Blog</span>
            } @else {
            <mat-icon>publish</mat-icon>
            <span>Publish Blog</span>
            }
          </div>
        </button>
      </div>

    </form>
  </mat-card>
</div>
