<!-- register.component.html -->
<div class="register-page">
  <div class="register-container">

    @if(_Refresh) {
    <div class="loading-state">
      <mat-spinner class="loading-spinner"></mat-spinner>
      <p class="loading-text">Creating your account...</p>
    </div>
    } @else {

    <!-- Register Card -->
    <div class="register-card">

      <!-- Header -->
      <div class="auth-header">
        <h2 class="auth-title">Create Account</h2>
        <p class="auth-subtitle">Join our community of amazing writers</p>
      </div>

      <!-- Register Form -->
      <form class="register-form" [formGroup]="registerForm" (ngSubmit)="onSubmit()">

        <!-- Username Field -->
        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <input matInput formControlName="username" placeholder="Choose a unique username" />
            <mat-icon matSuffix class="field-icon">alternate_email</mat-icon>

            @if(registerForm.get('username')?.hasError('required')) {
            <mat-error>
              <mat-icon>error</mat-icon>
              Username is required
            </mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Email Field -->
        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <input matInput formControlName="email" type="email" placeholder="Enter your email address" />
            <mat-icon matSuffix class="field-icon">email</mat-icon>

            @if(registerForm.get('email')?.hasError('required')) {
            <mat-error>
              <mat-icon>error</mat-icon>
              Email is required
            </mat-error>
            }
            @if(registerForm.get('email')?.hasError('email')) {
            <mat-error>
              <mat-icon>error</mat-icon>
              Invalid email address
            </mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Bio Field -->
        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <input matInput formControlName="bio" placeholder="Tell us about yourself (optional)" />
            <mat-icon matSuffix class="field-icon">description</mat-icon>
          </mat-form-field>
        </div>

        <!-- Password Field -->
        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <input matInput formControlName="password" [type]="hidePassword ? 'password' : 'text'"
              placeholder="Create a strong password" />

            <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button"
              class="password-toggle">
              <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>

            @if(registerForm.get('password')?.hasError('required')) {
            <mat-error>
              <mat-icon>error</mat-icon>
              Password is required
            </mat-error>
            }
            @if(registerForm.get('password')?.hasError('minlength')) {
            <mat-error>
              <mat-icon>error</mat-icon>
              Min 6 characters
            </mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Confirm Password Field -->
        <div class="form-group">
          <mat-form-field appearance="outline" class="full-width">
            <input matInput formControlName="confirmPassword" [type]="hideConfirmPassword ? 'password' : 'text'"
              placeholder="Confirm your password" />

            <button mat-icon-button matSuffix (click)="hideConfirmPassword = !hideConfirmPassword" type="button"
              class="password-toggle">
              <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>

            @if(registerForm.get('confirmPassword')?.hasError('required')) {
            <mat-error>
              <mat-icon>error</mat-icon>
              Confirmation is required
            </mat-error>
            }
            @if(passwordMismatch) {
            <mat-error>
              <mat-icon>error</mat-icon>
              Passwords do not match
            </mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Submit Button -->
        <button mat-raised-button color="primary" type="submit" [disabled]="registerForm.invalid">
          <span>Create Account</span>
        </button>

        <!-- Error Message -->
        @if (errorMessage) {
        <div class="error-message">
          <span>{{ errorMessage }}</span>
        </div>
        }

      </form>

      <!-- Auth Footer -->
      <div class="auth-footer">
        <div class="divider">
          <span>or</span>
        </div>

        <!-- Login Link -->
        <p class="auth-switch">
          Already have an account?
          <a (click)="goLogin()" class="switch-link">Sign in here</a>
        </p>
      </div>

    </div>

    }
  </div>
</div>
