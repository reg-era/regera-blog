<div class="blog-layout">
  @if(blog$ | async ;as blog){
  <!-- Main Blog Content -->
  <div class="blog-container">
    <section class="author-section">
      <h1>{{ blog.authorName }}</h1>
      <h2>Posted on {{ formatDate(blog.createdAt) }}</h2>
    </section>

    <section class="content-section">
      <h1 class="blog-title">{{ blog.title }}</h1>

      <section class="media-section">
        @if (blog.isVideo){
        <ng-container video>
          <video [src]="blog.media" controls playsinline></video>
        </ng-container>
        }@else {
        <ng-container image>
          <img [src]="blog.media" alt="blog cover" class="media-image" />
        </ng-container>
        }
      </section>

      <div class="blog-body" [innerHTML]="toHtml(blog.content)"></div>
    </section>
  </div>

  <!-- Sidebar / Comments Section -->
  <aside class="blog-sidebar">

    <!-- Follow + Likes -->
    <div class="interaction-header">
      <div class="likes">
        <mat-icon>favorite</mat-icon> {{ blog.likes }} likes
      </div>
      <button mat-raised-button color="accent" (click)="toggleLike()">
        {{ blog.isLiking ? 'UnLike' : 'Like' }}
      </button>
    </div>

    <!-- Sticky Comments Section -->
    <div class="comments-section fixed-comments">
      <h3>Comments</h3>

      <form [formGroup]="CommentFrom" (ngSubmit)="submitComment()">
        <mat-form-field appearance="outline">
          <mat-label>Your comment</mat-label>
          <input matInput formControlName="comment" placeholder="Submit comment..." />
        </mat-form-field>
      </form>


      <div class="all-comments">
        @if (comments$ | async ;as comments){
        @for (comment of comments; track comment.id) {
        <div class="comment">
          <strong>{{ comment.author }}</strong>
          <span> â€¢  {{ formatDate(comment.createdAt) }}</span>
          <p>{{ comment.content }}</p>
        </div>
        }
        }@else{
        <mat-spinner></mat-spinner>
        }
      </div>

      @if (!doneComment){
      <button class="more-comments" (click)="getMoreComment()">More Comments</button>
      }

    </div>
  </aside>
  }@else{
  <mat-spinner></mat-spinner>
  }
</div>
